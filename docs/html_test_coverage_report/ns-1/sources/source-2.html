


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > AutocompletePanel</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">&lt;empty package name&gt;</a>
</div>

<h1>Coverage Summary for Class: AutocompletePanel (&lt;empty package name&gt;)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">AutocompletePanel</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/18)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/155)
  </span>
</td>
</tr>
  <tr>
    <td class="name">AutocompletePanel$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AutocompletePanel$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/7)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AutocompletePanel$3</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AutocompletePanel$4</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AutocompletePanel$5</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/8)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AutocompletePanel$6</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/16)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AutocompletePanel$7</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/18)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AutocompletePanel$8</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AutocompletePanel$9</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/31)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/36)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/228)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;import java.awt.Color;
&nbsp;import java.awt.Dimension;
&nbsp;import java.awt.Font;
&nbsp;import java.awt.GridLayout;
&nbsp;import java.awt.event.ActionEvent;
&nbsp;import java.awt.event.ActionListener;
&nbsp;import java.awt.event.FocusEvent;
&nbsp;import java.awt.event.FocusListener;
&nbsp;import java.awt.event.MouseAdapter;
&nbsp;import java.awt.event.MouseEvent;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.Collections;
&nbsp;import java.util.List;
&nbsp;import javax.swing.AbstractAction;
&nbsp;import javax.swing.Action;
&nbsp;import javax.swing.BorderFactory;
&nbsp;import javax.swing.GroupLayout;
&nbsp;import javax.swing.JComponent;
&nbsp;import javax.swing.JList;
&nbsp;import javax.swing.JPanel;
&nbsp;import javax.swing.JScrollPane;
&nbsp;import javax.swing.JTextField;
&nbsp;import javax.swing.KeyStroke;
&nbsp;import javax.swing.ListSelectionModel;
&nbsp;import javax.swing.event.DocumentEvent;
&nbsp;import javax.swing.event.DocumentListener;
&nbsp;import javax.swing.event.MouseInputAdapter;
&nbsp;
&nbsp;public class AutocompletePanel
&nbsp;extends JPanel
&nbsp;{
&nbsp;// for serializable classes
&nbsp;private static final long serialVersionUID = 1L;
&nbsp;
&nbsp;private final JTextField  searchText;                            // the
&nbsp;                                                                 // search
&nbsp;                                                                 // bar
&nbsp;private Autocomplete              auto;                                  // the
&nbsp;                                                                 // Autocomplete
&nbsp;                                                                 // object
<b class="nc">&nbsp;private String[]          results          = new String[10];      // an</b>
&nbsp;                                                                 // array
&nbsp;                                                                 // of
&nbsp;                                                                 // matches
&nbsp;//// private JList&lt;String&gt; suggestions; // a list of autocomplete
&nbsp;//// matches (Java 7)
&nbsp;private JList             suggestions;                           // a
&nbsp;                                                                 // list
&nbsp;                                                                 // of
&nbsp;                                                                 // autocomplete
&nbsp;                                                                 // matches
&nbsp;                                                                 // (Java
&nbsp;                                                                 // 6)
&nbsp;private JScrollPane       scrollPane;                            // the
&nbsp;                                                                 // scroll
&nbsp;                                                                 // bar
&nbsp;                                                                 // on
&nbsp;                                                                 // the
&nbsp;                                                                 // side
&nbsp;                                                                 // of
&nbsp;                                                                 // the
&nbsp;private JPanel            suggestionsPanel;                      // the
&nbsp;                                                                 // dropdown
&nbsp;                                                                 // menu
&nbsp;                                                                 // of
&nbsp;                                                                 // suggestions
<b class="nc">&nbsp;private int               extraMargin      = 5;                  // extra</b>
&nbsp;                                                                 // room
&nbsp;                                                                 // to
&nbsp;                                                                 // leave
&nbsp;                                                                 // at
&nbsp;                                                                 // the
&nbsp;                                                                 // bottom
&nbsp;                                                                 // of
&nbsp;                                                                 // the
&nbsp;                                                                 // suggestion
&nbsp;                                                                 // drop-down
&nbsp;                                                                 // below
&nbsp;                                                                 // the
&nbsp;                                                                 // last
&nbsp;                                                                 // suggestion
&nbsp;
&nbsp;// Note: can&#39;t use JList&lt;String&gt; in Java 6
&nbsp;
&nbsp;// TODO: change how this is implemented so it is dynamic;
&nbsp;// shouldn&#39;t have to define a column number.
&nbsp;
&nbsp;// Keep these next two values in sync! - used to keep the search box
&nbsp;// the same width as the drop-down
&nbsp;// DEF_COLUMNS should be the number of characters in suggListLen
&nbsp;
&nbsp;// number of columns in the search text that is kept
<b class="nc">&nbsp;private final int         DEF_COLUMNS      = 45;</b>
&nbsp;
&nbsp;// an example of one of the longest strings in the database
<b class="nc">&nbsp;private final String      suggListLen      =</b>
&nbsp;    &quot;&lt;b&gt;Harry Potter and the Deathly Hallows: Part 1 (2010)&lt;/b&gt;&quot;;
&nbsp;
&nbsp;
&nbsp;/**
&nbsp; * Creates the Autocomplete object and the search bar and suggestion
&nbsp; * drop-down portions of the GUI
&nbsp; *
&nbsp; * @param filename
&nbsp; *            the file the Autocomplete object is constructed from
&nbsp; */
&nbsp;public AutocompletePanel(String filename)
&nbsp;{
<b class="nc">&nbsp;    super();</b>
&nbsp;
&nbsp;    
&nbsp;
&nbsp;
<b class="nc">&nbsp;    auto = new Autocomplete();</b>
<b class="nc">&nbsp;    auto.buildTrie(filename, 6);</b>
&nbsp;
&nbsp;
<b class="nc">&nbsp;    GroupLayout layout = new GroupLayout(this);</b>
<b class="nc">&nbsp;    this.setLayout(layout);</b>
&nbsp;
&nbsp;    // create the search text, and allow the user to interact with it
<b class="nc">&nbsp;    searchText = new JTextField(DEF_COLUMNS);</b>
<b class="nc">&nbsp;    searchText.setMaximumSize(</b>
&nbsp;        new Dimension(
<b class="nc">&nbsp;            searchText.getMaximumSize().width,</b>
<b class="nc">&nbsp;            searchText.getPreferredSize().height));</b>
<b class="nc">&nbsp;    searchText.getInputMap().put(KeyStroke.getKeyStroke(&quot;UP&quot;), &quot;none&quot;);</b>
<b class="nc">&nbsp;    searchText.getInputMap()</b>
<b class="nc">&nbsp;        .put(KeyStroke.getKeyStroke(&quot;DOWN&quot;), &quot;none&quot;);</b>
<b class="nc">&nbsp;    searchText.addFocusListener(new FocusListener() {</b>
&nbsp;        @Override
&nbsp;        public void focusGained(FocusEvent e)
&nbsp;        {
<b class="nc">&nbsp;            int pos = searchText.getText().length();</b>
<b class="nc">&nbsp;            searchText.setCaretPosition(pos);</b>
&nbsp;        }
&nbsp;
&nbsp;
&nbsp;        public void focusLost(FocusEvent e)
&nbsp;        {
<b class="nc">&nbsp;        }</b>
&nbsp;    });
&nbsp;
&nbsp;    // create the search text box
<b class="nc">&nbsp;    JPanel searchTextPanel = new JPanel();</b>
<b class="nc">&nbsp;    searchTextPanel.add(searchText);</b>
<b class="nc">&nbsp;    searchTextPanel</b>
<b class="nc">&nbsp;        .setBorder(BorderFactory.createEmptyBorder(0, 0, 0, 0));</b>
<b class="nc">&nbsp;    searchTextPanel.setLayout(new GridLayout(1, 1));</b>
&nbsp;
&nbsp;    // create the drop-down menu items
<b class="nc">&nbsp;    int fontsize = 13;</b>
<b class="nc">&nbsp;    int cellHeight = 20;</b>
&nbsp;
&nbsp;    // suggestions = new JList&lt;String&gt;(results);
<b class="nc">&nbsp;    suggestions = new JList(results);</b>
<b class="nc">&nbsp;    suggestions</b>
<b class="nc">&nbsp;        .setBorder(BorderFactory.createLineBorder(Color.BLACK, 1));</b>
<b class="nc">&nbsp;    suggestions.setVisible(false);</b>
<b class="nc">&nbsp;    suggestions.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);</b>
<b class="nc">&nbsp;    suggestions.setMaximumSize(</b>
&nbsp;        new Dimension(
<b class="nc">&nbsp;            searchText.getMaximumSize().width,</b>
<b class="nc">&nbsp;            suggestions.getPreferredSize().height));</b>
&nbsp;
&nbsp;    // Set to make equal to the width of the textfield
<b class="nc">&nbsp;    suggestions.setPrototypeCellValue(suggListLen);</b>
<b class="nc">&nbsp;    suggestions.setFont(</b>
<b class="nc">&nbsp;        suggestions.getFont().deriveFont(Font.PLAIN, fontsize));</b>
<b class="nc">&nbsp;    suggestions.setFixedCellHeight(cellHeight);</b>
&nbsp;
&nbsp;    // add arrow-key interactivity to the drop-down menu items
<b class="nc">&nbsp;    Action makeSelection = new AbstractAction() {</b>
&nbsp;        // for serializable classes
&nbsp;        private static final long serialVersionUID = 1L;
&nbsp;
&nbsp;
&nbsp;        public void actionPerformed(ActionEvent e)
&nbsp;        {
<b class="nc">&nbsp;            if (!suggestions.isSelectionEmpty())</b>
&nbsp;            {
<b class="nc">&nbsp;                String selection =</b>
<b class="nc">&nbsp;                    (String)suggestions.getSelectedValue();</b>
&nbsp;                
<b class="nc">&nbsp;                selection = selection.replaceAll(&quot;\\&lt;.*?&gt;&quot;, &quot;&quot;);</b>
<b class="nc">&nbsp;                searchText.setText(selection);</b>
<b class="nc">&nbsp;                getSuggestions(selection);</b>
&nbsp;            }
&nbsp;        }
&nbsp;    };
<b class="nc">&nbsp;    Action moveSelectionUp = new AbstractAction() {</b>
&nbsp;        // for serializable classes
&nbsp;        private static final long serialVersionUID = 1L;
&nbsp;
&nbsp;
&nbsp;        @Override
&nbsp;        public void actionPerformed(ActionEvent e)
&nbsp;        {
<b class="nc">&nbsp;            if (suggestions.getSelectedIndex() &gt;= 0)</b>
&nbsp;            {
<b class="nc">&nbsp;                suggestions.requestFocusInWindow();</b>
<b class="nc">&nbsp;                suggestions.setSelectedIndex(</b>
<b class="nc">&nbsp;                    suggestions.getSelectedIndex() - 1);</b>
&nbsp;            }
&nbsp;        }
&nbsp;    };
<b class="nc">&nbsp;    Action moveSelectionDown = new AbstractAction() {</b>
&nbsp;        // for serializable classes
&nbsp;        private static final long serialVersionUID = 1L;
&nbsp;
&nbsp;
&nbsp;        public void actionPerformed(ActionEvent e)
&nbsp;        {
<b class="nc">&nbsp;            if (suggestions.getSelectedIndex() != results.length)</b>
&nbsp;            {
<b class="nc">&nbsp;                suggestions.requestFocusInWindow();</b>
<b class="nc">&nbsp;                suggestions.setSelectedIndex(</b>
<b class="nc">&nbsp;                    suggestions.getSelectedIndex() + 1);</b>
&nbsp;            }
&nbsp;        }
&nbsp;    };
<b class="nc">&nbsp;    Action moveSelectionUpFocused = new AbstractAction() {</b>
&nbsp;        // for serializable classes
&nbsp;        private static final long serialVersionUID = 1L;
&nbsp;
&nbsp;
&nbsp;        public void actionPerformed(ActionEvent e)
&nbsp;        {
<b class="nc">&nbsp;            if (suggestions.getSelectedIndex() == 0)</b>
&nbsp;            {
<b class="nc">&nbsp;                suggestions.clearSelection();</b>
<b class="nc">&nbsp;                searchText.requestFocusInWindow();</b>
<b class="nc">&nbsp;                searchText.setSelectionEnd(0);</b>
&nbsp;            }
<b class="nc">&nbsp;            else if (suggestions.getSelectedIndex() &gt;= 0)</b>
&nbsp;            {
<b class="nc">&nbsp;                suggestions.setSelectedIndex(</b>
<b class="nc">&nbsp;                    suggestions.getSelectedIndex() - 1);</b>
&nbsp;            }
&nbsp;        }
&nbsp;    };
<b class="nc">&nbsp;    suggestions.getInputMap(JComponent.WHEN_IN_FOCUSED_WINDOW)</b>
<b class="nc">&nbsp;        .put(KeyStroke.getKeyStroke(&quot;UP&quot;), &quot;moveSelectionUp&quot;);</b>
<b class="nc">&nbsp;    suggestions.getInputMap(JComponent.WHEN_IN_FOCUSED_WINDOW)</b>
<b class="nc">&nbsp;        .put(KeyStroke.getKeyStroke(&quot;DOWN&quot;), &quot;moveSelectionDown&quot;);</b>
<b class="nc">&nbsp;    suggestions.getActionMap().put(&quot;moveSelectionUp&quot;, moveSelectionUp);</b>
<b class="nc">&nbsp;    suggestions.getActionMap()</b>
<b class="nc">&nbsp;        .put(&quot;moveSelectionDown&quot;, moveSelectionDown);</b>
<b class="nc">&nbsp;    suggestions.getInputMap(JComponent.WHEN_FOCUSED)</b>
<b class="nc">&nbsp;        .put(KeyStroke.getKeyStroke(&quot;ENTER&quot;), &quot;makeSelection&quot;);</b>
<b class="nc">&nbsp;    suggestions.getInputMap()</b>
<b class="nc">&nbsp;        .put(KeyStroke.getKeyStroke(&quot;UP&quot;), &quot;moveSelectionUpFocused&quot;);</b>
<b class="nc">&nbsp;    suggestions.getActionMap()</b>
<b class="nc">&nbsp;        .put(&quot;moveSelectionUpFocused&quot;, moveSelectionUpFocused);</b>
<b class="nc">&nbsp;    suggestions.getActionMap().put(&quot;makeSelection&quot;, makeSelection);</b>
&nbsp;
&nbsp;    // Create the suggestion drop-down panel and scroll bar
<b class="nc">&nbsp;    suggestionsPanel = new JPanel();</b>
&nbsp;
<b class="nc">&nbsp;    scrollPane = new JScrollPane(suggestions);</b>
<b class="nc">&nbsp;    scrollPane.setVisible(false);</b>
<b class="nc">&nbsp;    int prefBarWidth =</b>
<b class="nc">&nbsp;        scrollPane.getVerticalScrollBar().getPreferredSize().width;</b>
<b class="nc">&nbsp;    suggestions.setPreferredSize(</b>
<b class="nc">&nbsp;        new Dimension(searchText.getPreferredSize().width, 0));</b>
<b class="nc">&nbsp;    scrollPane.setAutoscrolls(true);</b>
<b class="nc">&nbsp;    scrollPane.setHorizontalScrollBarPolicy(</b>
&nbsp;        JScrollPane.HORIZONTAL_SCROLLBAR_NEVER);
<b class="nc">&nbsp;    scrollPane.setVerticalScrollBarPolicy(</b>
&nbsp;        JScrollPane.VERTICAL_SCROLLBAR_AS_NEEDED);
&nbsp;
&nbsp;    // resize widths and heights of all components to fit nicely
<b class="nc">&nbsp;    int preferredWidth =</b>
<b class="nc">&nbsp;        searchText.getPreferredSize().width + 2 * prefBarWidth;</b>
<b class="nc">&nbsp;    int maxWidth = searchText.getMaximumSize().width + 2 * prefBarWidth;</b>
<b class="nc">&nbsp;    int searchBarHeight = searchText.getPreferredSize().height;</b>
<b class="nc">&nbsp;    int suggestionHeight = suggestions.getFixedCellHeight();</b>
<b class="nc">&nbsp;    int maxSuggestionHeight = 200;</b>
&nbsp;
<b class="nc">&nbsp;    suggestionsPanel.setPreferredSize(</b>
&nbsp;        new Dimension(preferredWidth, suggestionHeight));
<b class="nc">&nbsp;    suggestionsPanel</b>
<b class="nc">&nbsp;        .setMaximumSize(new Dimension(maxWidth, maxSuggestionHeight));</b>
<b class="nc">&nbsp;    suggestionsPanel</b>
<b class="nc">&nbsp;        .setBorder(BorderFactory.createEmptyBorder(0, 0, 0, 0));</b>
<b class="nc">&nbsp;    suggestionsPanel.add(scrollPane);</b>
<b class="nc">&nbsp;    suggestionsPanel.setLayout(new GridLayout(1, 1));</b>
&nbsp;
<b class="nc">&nbsp;    this.setPreferredSize(</b>
<b class="nc">&nbsp;        new Dimension(preferredWidth, this.getPreferredSize().height));</b>
<b class="nc">&nbsp;    this.setMaximumSize(</b>
&nbsp;        new Dimension(
&nbsp;            preferredWidth,
&nbsp;            searchBarHeight + maxSuggestionHeight));
&nbsp;
<b class="nc">&nbsp;    searchTextPanel.setPreferredSize(</b>
&nbsp;        new Dimension(preferredWidth, searchBarHeight));
<b class="nc">&nbsp;    searchTextPanel</b>
<b class="nc">&nbsp;        .setMaximumSize(new Dimension(maxWidth, searchBarHeight));</b>
<b class="nc">&nbsp;    searchText.setMaximumSize(new Dimension(maxWidth, searchBarHeight));</b>
&nbsp;
&nbsp;    // add mouse interactivity with the drop-down menu
<b class="nc">&nbsp;    suggestions.addMouseListener(new MouseAdapter() {</b>
&nbsp;        @Override
&nbsp;        public void mouseClicked(MouseEvent mouseEvent)
&nbsp;        {
<b class="nc">&nbsp;            JList theList = (JList)mouseEvent.getSource();</b>
<b class="nc">&nbsp;            if (mouseEvent.getClickCount() &gt;= 1)</b>
&nbsp;            {
<b class="nc">&nbsp;                int index =</b>
<b class="nc">&nbsp;                    theList.locationToIndex(mouseEvent.getPoint());</b>
<b class="nc">&nbsp;                if (index &gt;= 0)</b>
&nbsp;                {
<b class="nc">&nbsp;                    String selection = getSelectedText();</b>
<b class="nc">&nbsp;                    searchText.setText(selection);</b>
<b class="nc">&nbsp;                    String text = searchText.getText();</b>
<b class="nc">&nbsp;                    getSuggestions(text);</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;
&nbsp;        @Override
&nbsp;        public void mouseEntered(MouseEvent mouseEvent)
&nbsp;        {
<b class="nc">&nbsp;            JList theList = (JList)mouseEvent.getSource();</b>
<b class="nc">&nbsp;            int index = theList.locationToIndex(mouseEvent.getPoint());</b>
<b class="nc">&nbsp;            theList.requestFocusInWindow();</b>
<b class="nc">&nbsp;            theList.setSelectedIndex(index);</b>
&nbsp;        }
&nbsp;
&nbsp;
&nbsp;        @Override
&nbsp;        public void mouseExited(MouseEvent mouseEvent)
&nbsp;        {
<b class="nc">&nbsp;            suggestions.clearSelection();</b>
<b class="nc">&nbsp;            searchText.requestFocusInWindow();</b>
&nbsp;        }
&nbsp;    });
<b class="nc">&nbsp;    suggestions.addMouseMotionListener(new MouseInputAdapter() {</b>
&nbsp;        @Override
&nbsp;
&nbsp;        // Google a term when a user clicks on the dropdown menu
&nbsp;        public void mouseClicked(MouseEvent mouseEvent)
&nbsp;        {
<b class="nc">&nbsp;            JList theList = (JList)mouseEvent.getSource();</b>
<b class="nc">&nbsp;            if (mouseEvent.getClickCount() &gt;= 1)</b>
&nbsp;            {
<b class="nc">&nbsp;                int index =</b>
<b class="nc">&nbsp;                    theList.locationToIndex(mouseEvent.getPoint());</b>
<b class="nc">&nbsp;                if (index &gt;= 0)</b>
&nbsp;                {
<b class="nc">&nbsp;                    String selection = getSelectedText();</b>
<b class="nc">&nbsp;                    searchText.setText(selection);</b>
<b class="nc">&nbsp;                    String text = searchText.getText();</b>
<b class="nc">&nbsp;                    getSuggestions(text);</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;
&nbsp;        @Override
&nbsp;        public void mouseEntered(MouseEvent mouseEvent)
&nbsp;        {
<b class="nc">&nbsp;            JList theList = (JList)mouseEvent.getSource();</b>
<b class="nc">&nbsp;            int index = theList.locationToIndex(mouseEvent.getPoint());</b>
<b class="nc">&nbsp;            theList.requestFocusInWindow();</b>
<b class="nc">&nbsp;            theList.setSelectedIndex(index);</b>
&nbsp;        }
&nbsp;
&nbsp;
&nbsp;        @Override
&nbsp;        public void mouseMoved(MouseEvent mouseEvent)
&nbsp;        {
<b class="nc">&nbsp;            JList theList = (JList)mouseEvent.getSource();</b>
<b class="nc">&nbsp;            int index = theList.locationToIndex(mouseEvent.getPoint());</b>
<b class="nc">&nbsp;            theList.requestFocusInWindow();</b>
<b class="nc">&nbsp;            theList.setSelectedIndex(index);</b>
&nbsp;        }
&nbsp;    });
&nbsp;
&nbsp;    // add a listener that allows updates each time the user types
<b class="nc">&nbsp;    searchText.getDocument()</b>
<b class="nc">&nbsp;        .addDocumentListener(new DocumentListener() {</b>
&nbsp;            public void insertUpdate(DocumentEvent e)
&nbsp;            {
<b class="nc">&nbsp;                changedUpdate(e);</b>
&nbsp;            }
&nbsp;
&nbsp;
&nbsp;            public void removeUpdate(DocumentEvent e)
&nbsp;            {
<b class="nc">&nbsp;                changedUpdate(e);</b>
&nbsp;            }
&nbsp;
&nbsp;
&nbsp;            public void changedUpdate(DocumentEvent e)
&nbsp;            {
<b class="nc">&nbsp;                String text = searchText.getText().trim();</b>
&nbsp;
&nbsp;                // updates the drop-down menu
<b class="nc">&nbsp;                getSuggestions(text);</b>
<b class="nc">&nbsp;                updateListSize();</b>
&nbsp;            }
&nbsp;        });
&nbsp;
&nbsp;    // When a user clicks on a suggestion, Google it
<b class="nc">&nbsp;    searchText.addActionListener(new ActionListener() {</b>
&nbsp;        public void actionPerformed(ActionEvent e)
&nbsp;        {
<b class="nc">&nbsp;            String selection = getSelectedText();</b>
<b class="nc">&nbsp;            searchText.setText(selection);</b>
<b class="nc">&nbsp;            getSuggestions(selection);</b>
&nbsp;        }
&nbsp;    });
&nbsp;
&nbsp;    // Define the layout of the text box and suggestion dropdown
<b class="nc">&nbsp;    layout.setHorizontalGroup(</b>
<b class="nc">&nbsp;        layout.createSequentialGroup().addGroup(</b>
<b class="nc">&nbsp;            layout.createParallelGroup(GroupLayout.Alignment.LEADING)</b>
<b class="nc">&nbsp;                .addComponent(</b>
&nbsp;                    searchTextPanel,
&nbsp;                    0,
&nbsp;                    GroupLayout.DEFAULT_SIZE,
&nbsp;                    GroupLayout.PREFERRED_SIZE)
<b class="nc">&nbsp;                .addComponent(</b>
&nbsp;                    suggestionsPanel,
&nbsp;                    GroupLayout.DEFAULT_SIZE,
&nbsp;                    GroupLayout.DEFAULT_SIZE,
&nbsp;                    GroupLayout.PREFERRED_SIZE))
&nbsp;
&nbsp;    );
&nbsp;
<b class="nc">&nbsp;    layout.setVerticalGroup(</b>
<b class="nc">&nbsp;        layout.createSequentialGroup().addComponent(searchTextPanel)</b>
<b class="nc">&nbsp;            .addComponent(suggestionsPanel));</b>
&nbsp;}
&nbsp;
&nbsp;
&nbsp;/**
&nbsp; * Re-populates the drop-down menu with the new suggestions, and resizes
&nbsp; * the containing panel vertically
&nbsp; */
&nbsp;private void updateListSize()
&nbsp;{
<b class="nc">&nbsp;    int rows = 5;</b>
<b class="nc">&nbsp;    if (suggestions.getModel().getSize() &lt; 5)</b>
&nbsp;    {
<b class="nc">&nbsp;        rows = suggestions.getModel().getSize();</b>
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    int suggWidth = searchText.getPreferredSize().width;</b>
<b class="nc">&nbsp;    int suggPanelWidth = suggestionsPanel.getPreferredSize().width;</b>
<b class="nc">&nbsp;    int suggHeight = rows * suggestions.getFixedCellHeight();</b>
&nbsp;
<b class="nc">&nbsp;    suggestions.setPreferredSize(new Dimension(suggWidth, suggHeight));</b>
<b class="nc">&nbsp;    suggestionsPanel.setPreferredSize(</b>
&nbsp;        new Dimension(suggPanelWidth, suggHeight + extraMargin));
<b class="nc">&nbsp;    suggestionsPanel.setMaximumSize(</b>
&nbsp;        new Dimension(suggPanelWidth, suggHeight + extraMargin));
&nbsp;
&nbsp;    // redraw the suggestion panel
<b class="nc">&nbsp;    suggestionsPanel.setVisible(false);</b>
<b class="nc">&nbsp;    suggestionsPanel.setVisible(true);</b>
&nbsp;}
&nbsp;
&nbsp;
&nbsp;// see getSuggestions for documentation
&nbsp;public void update()
&nbsp;{
<b class="nc">&nbsp;    getSuggestions(searchText.getText());</b>
&nbsp;}
&nbsp;
&nbsp;
&nbsp;/**
&nbsp; * Makes a call to the implementation of Autocomplete to get suggestions
&nbsp; * for the currently entered text.
&nbsp; *
&nbsp; * @param text
&nbsp; *            string to search for
&nbsp; */
&nbsp;public void getSuggestions(String text)
&nbsp;{
&nbsp;
&nbsp;    // don&#39;t search for suggestions if there is no input
<b class="nc">&nbsp;    if (text.equals(&quot;&quot;))</b>
&nbsp;    {
<b class="nc">&nbsp;        suggestions.setListData(new String[0]);</b>
<b class="nc">&nbsp;        suggestions.clearSelection();</b>
<b class="nc">&nbsp;        suggestions.setVisible(false);</b>
<b class="nc">&nbsp;        scrollPane.setVisible(false);</b>
&nbsp;    }
&nbsp;    else
&nbsp;    {
<b class="nc">&nbsp;        text = text.trim();</b>
&nbsp;
<b class="nc">&nbsp;        int textLen = text.length();</b>
&nbsp;        // clear the previous match
<b class="nc">&nbsp;        List&lt;ITerm&gt;matches = new ArrayList&lt;ITerm&gt;();</b>
<b class="nc">&nbsp;        matches = auto.getSuggestions(text);</b>
&nbsp;        
&nbsp;
<b class="nc">&nbsp;         Collections</b>
<b class="nc">&nbsp;         .sort(matches, ITerm.byReverseWeightOrder());</b>
&nbsp;
&nbsp;
<b class="nc">&nbsp;         Term[] allResults = matches.toArray(new Term[matches.size()]);</b>
&nbsp;
<b class="nc">&nbsp;        if (allResults == null)</b>
&nbsp;        {
<b class="nc">&nbsp;            throw new NullPointerException(&quot;allMatches() is null&quot;);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        results = new String[Math.min(10, allResults.length)];</b>
<b class="nc">&nbsp;        if (Math.min(10, allResults.length) &gt; 0)</b>
&nbsp;        {
<b class="nc">&nbsp;            for (int i = 0; i &lt; results.length; i++)</b>
&nbsp;            {
&nbsp;
&nbsp;                // A bit of a hack to get the Term&#39;s query string
&nbsp;                // and weight from toString()
<b class="nc">&nbsp;                String next = allResults[i].toString();</b>
&nbsp;
<b class="nc">&nbsp;                if (allResults[i] == null)</b>
&nbsp;                {
<b class="nc">&nbsp;                    throw new NullPointerException(</b>
&nbsp;                        &quot;allMatches() &quot;
&nbsp;                            + &quot;returned an array with a null entry&quot;);
&nbsp;                }
<b class="nc">&nbsp;                int tab = next.indexOf(&#39;\t&#39;);</b>
<b class="nc">&nbsp;                if (tab &lt; 0)</b>
&nbsp;                {
<b class="nc">&nbsp;                    throw new RuntimeException(</b>
&nbsp;                        &quot;allMatches() returned&quot;
&nbsp;                            + &quot; an array with an entry without a tab:&quot;
&nbsp;                            + &quot; &#39;&quot; + next + &quot;&#39;&quot;);
&nbsp;                }
<b class="nc">&nbsp;                String weight = next.substring(0, tab).trim();</b>
<b class="nc">&nbsp;                String query = next.substring(tab).trim();</b>
&nbsp;
&nbsp;                // truncate length if needed
<b class="nc">&nbsp;                if (query.length() &gt; suggListLen.length())</b>
<b class="nc">&nbsp;                    query = query.substring(0, suggListLen.length());</b>
&nbsp;
&nbsp;                // create the table HTML
<b class="nc">&nbsp;                results[i] = &quot;&lt;html&gt;&lt;table width=\&quot;&quot;</b>
<b class="nc">&nbsp;                    + searchText.getPreferredSize().width + &quot;\&quot;&gt;&quot;</b>
&nbsp;                    + &quot;&lt;tr&gt;&lt;td align=left&gt;&quot;
<b class="nc">&nbsp;                    + query.substring(0, textLen) + &quot;&lt;b&gt;&quot;</b>
<b class="nc">&nbsp;                    + query.substring(textLen) + &quot;&lt;/b&gt;&quot;;</b>
&nbsp;                
<b class="nc">&nbsp;                results[i] += &quot;&lt;/table&gt;&lt;/html&gt;&quot;;</b>
&nbsp;            }
<b class="nc">&nbsp;            suggestions.setListData(results);</b>
<b class="nc">&nbsp;            suggestions.setVisible(true);</b>
<b class="nc">&nbsp;            scrollPane.setVisible(true);</b>
&nbsp;        }
&nbsp;        else
&nbsp;        {
&nbsp;            // No suggestions
<b class="nc">&nbsp;            suggestions.setListData(new String[0]);</b>
<b class="nc">&nbsp;            suggestions.clearSelection();</b>
<b class="nc">&nbsp;            suggestions.setVisible(false);</b>
<b class="nc">&nbsp;            scrollPane.setVisible(false);</b>
&nbsp;        }
&nbsp;    }
&nbsp;}
&nbsp;
&nbsp;
&nbsp;// bring the clicked suggestion up to the Search bar and search it
&nbsp;public String getSelectedText()
&nbsp;{
<b class="nc">&nbsp;    if (!suggestions.isSelectionEmpty())</b>
&nbsp;    {
<b class="nc">&nbsp;        String selection = (String)suggestions.getSelectedValue();</b>
&nbsp;        
<b class="nc">&nbsp;        selection = selection.replaceAll(&quot;\\&lt;.*?&gt;&quot;, &quot;&quot;);</b>
<b class="nc">&nbsp;        selection = selection.replaceAll(&quot;^[ \t]+|[ \t]+$&quot;, &quot;&quot;);</b>
<b class="nc">&nbsp;        return selection;</b>
&nbsp;    }
&nbsp;    else
&nbsp;    {
<b class="nc">&nbsp;        return getSearchText();</b>
&nbsp;    }
&nbsp;}
&nbsp;
&nbsp;
&nbsp;public String getSearchText()
&nbsp;{
<b class="nc">&nbsp;    return searchText.getText();</b>
&nbsp;}
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2025-04-14 21:04</div>
</div>
</body>
</html>
